<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.51" />
    <meta name="description" content="">


    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link rel="icon" href="/images/favicon.png" type="image/x-icon" />

    <title>OpenCV 4 Support And Custom Profiling :: GoCV - Golang Computer Vision Using OpenCV 3</title>
    
    
    <link href="/css/nucleus.css?1543428573" rel="stylesheet">
    <link href="/css/font-awesome.min.css?1543428573" rel="stylesheet">
    <link href="/css/hybrid.css?1543428573" rel="stylesheet">
    <link href="/css/featherlight.min.css?1543428573" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1543428573" rel="stylesheet">
    <link href="/css/auto-complete.css?1543428573" rel="stylesheet">
    <link href="/css/theme.css?1543428573" rel="stylesheet">
    <link href="/css/hugo-theme.css?1543428573" rel="stylesheet">
    

    <script src="/js/jquery-2.x.min.js?1543428573"></script>
    
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{ 
          display:none !important;
      }
      
    </style>
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-46433484-8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-46433484-8');
</script>

  </head>
  <body class="" data-url="/blog/2018-11-28-opencv-4-support-and-custom-profiling/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <html>
<a href="http://gocv.io"><img src="https://raw.githubusercontent.com/hybridgroup/gocv/master/images/gocvlogo.jpg">
<h2 style="color:white; margin:0;">GoCV</h2>
<h4 style="color:white; margin:0;">Computer Vision using Go and OpenCV 4</h4></a>
</html>
    </div>
    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/computer-vision/" title="Computer Vision" class="dd-item 
        
        
        
        ">
      <a href="/computer-vision/">
          Computer Vision
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/getting-started/" title="Getting Started" class="dd-item 
        
        
        
        ">
      <a href="/getting-started/">
          Getting Started
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/getting-started/linux/" title="Linux" class="dd-item ">
        <a href="/getting-started/linux/">
        Linux
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/getting-started/macos/" title="macOS" class="dd-item ">
        <a href="/getting-started/macos/">
        macOS
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/getting-started/windows/" title="Windows" class="dd-item ">
        <a href="/getting-started/windows/">
        Windows
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/writing-code/" title="Writing Code" class="dd-item 
        
        
        
        ">
      <a href="/writing-code/">
          Writing Code
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/writing-code/hello-video/" title="Hello Video" class="dd-item ">
        <a href="/writing-code/hello-video/">
        Hello Video
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/writing-code/face-detect/" title="Face Detect" class="dd-item ">
        <a href="/writing-code/face-detect/">
        Face Detect
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/writing-code/more-examples/" title="More Examples" class="dd-item ">
        <a href="/writing-code/more-examples/">
        More Examples
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/blog/" title="Blog" class="dd-item 
        parent
        
        
        ">
      <a href="/blog/">
          Blog
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/blog/2018-11-28-opencv-4-support-and-custom-profiling/" title="OpenCV 4 Support And Custom Profiling" class="dd-item active">
        <a href="/blog/2018-11-28-opencv-4-support-and-custom-profiling/">
        OpenCV 4 Support And Custom Profiling
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/blog/2018-07-05-going-deeper-into-dnn/" title="Going Deeper Into DNN For Computer Vision" class="dd-item ">
        <a href="/blog/2018-07-05-going-deeper-into-dnn/">
        Going Deeper Into DNN For Computer Vision
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/blog/2018-03-26-this-one-goes-to-0.11/" title="This One Goes to 0.11" class="dd-item ">
        <a href="/blog/2018-03-26-this-one-goes-to-0.11/">
        This One Goes to 0.11
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/blog/2018-01-23-go-opencv-tensorflow-caffe/" title="Go, OpenCV, Caffe, and Tensorflow: Putting It All Together With GoCV" class="dd-item ">
        <a href="/blog/2018-01-23-go-opencv-tensorflow-caffe/">
        Go, OpenCV, Caffe, and Tensorflow: Putting It All Together With GoCV
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/blog/2017-12-14-putting-eyes-on-the-iot-video/" title="Putting Eyes on the IoT - The Video" class="dd-item ">
        <a href="/blog/2017-12-14-putting-eyes-on-the-iot-video/">
        Putting Eyes on the IoT - The Video
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/blog/2017-12-14-gocv-the-blog/" title="Introducing the GoCV Blog" class="dd-item ">
        <a href="/blog/2017-12-14-gocv-the-blog/">
        Introducing the GoCV Blog
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/cvscope/" title="CVscope" class="dd-item 
        
        
        
        ">
      <a href="/cvscope/">
          CVscope
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li class="" role=""> 
                  <a class="padding" href="https://github.com/hybridgroup/gocv"><i class='fa fa-github'></i> Github repo</a>
              </li>
          
              <li class="" role=""> 
                  <a class="padding" href="https://godoc.org/gocv.io/x/gocv"><i class='fa fa-book'></i> Godoc</a>
              </li>
          
              <li class="" role=""> 
                  <a class="padding" href="https://twitter.com/GoCVio"><i class='fa fa-twitter'></i> Twitter</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <center style="margin-top: -50px">Like what you see? Give GoCV a star!
<a class="github-button" href="https://github.com/hybridgroup/gocv" data-icon="octicon-star" data-show-count="true" aria-label="Star GoCV on GitHub">Star</a>
<a class="github-button" href="https://github.com/hybridgroup/gocv/fork" data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork GoCV on GitHub">Fork</a>

    <p>GoCV created by <a href="https://hybridgroup.com">The Hybrid Group</a></p>
    <p></p>
    <p>Site built with <a href="http://gohugo.io/">Hugo</a></p>
</center>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable sticky-parent">
              
              <div class="sticky-spacer">
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" href="https://github.com/hybridgroup/gocv-site/edit/master/content/blog/2018-11-28-opencv-4-support-and-custom-profiling.md" target="blank">
                      <i class="fa fa-code-fork"></i>
                      Edit this page
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fa fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                  
                  <span class="links">
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Home</a> > <a href='/blog/'>Blog</a> > OpenCV 4 Support And Custom Profiling
          
         
          
         
          
           
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#opencv-4-0-0-and-beyond">OpenCV 4.0.0 and beyond</a></li>
<li><a href="#matprofile-to-catch-the-memory-leaks">MatProfile To Catch The Memory Leaks</a></li>
<li><a href="#stay-informed">Stay Informed</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>OpenCV 4 Support And Custom Profiling</h1>
          

        




<p>We&rsquo;re proud to announce our latest release of GoCV (<a href="https://gocv.io">https://gocv.io</a>) version 0.18.0. This is a big update, because we are now supporting the long awaited and just-released OpenCV version 4.0.</p>

<p>We also have some great new features from our amazing contributors. Thank you to everyone who has helped with the project getting ready for the release.</p>

<p>You can take a look at the full changelog at <a href="https://github.com/hybridgroup/gocv/blob/master/CHANGELOG.md#0180">https://github.com/hybridgroup/gocv/blob/master/CHANGELOG.md#0180</a> for the details, or read on to learn more.</p>

<h3 id="opencv-4-0-0-and-beyond">OpenCV 4.0.0 and beyond</h3>

<p>The hard-working OpenCV team has just shipped a huge update in version 4.0.0 and the new GoCV is intended to work only with this release and future releases in version 4.0. The future is here and now, dear friends.</p>

<p>All of our installation information is now updated for OpenCV 4, and we also have made some improvements for you. In particular, for macOS developers, we now have a Homebrew forumla that will not only install OpenCV 4, but also provided a more stripped down installation by doing so without all of the extra Python dependencies.</p>

<h3 id="matprofile-to-catch-the-memory-leaks">MatProfile To Catch The Memory Leaks</h3>

<p><img src="../../images/gocv-profile-example.png" alt="MatProfile" /></p>

<p>Thanks to new contributor <a href="https://github.com/dougnd">@dougnd</a> we now have custom <a href="https://golang.org/pkg/runtime/pprof/">pprof</a> profiling for Mat creation.</p>

<p>Since memory allocations for images and any other <code>Mat</code> in GoCV are done through C based code, the Go garbage collector will not clean all resources associated with a <code>Mat</code>. As a result, any <code>Mat</code> created <em>must</em> be closed to avoid memory leaks.</p>

<p>In order to ease the detection and repair of this kind of resource leaks, the new <code>MatProfile</code> custom profiler has been added.</p>

<p>To include the <code>MatProfile</code> custom profiler, you MUST build or run your application or tests using the <code>-tags matprofile</code> build tag. For example:</p>

<pre><code>go run -tags matprofile cmd/version/main.go
</code></pre>

<p>You can then get the profile&rsquo;s count at any time using:</p>

<pre><code class="language-go">gocv.MatProfile.Count()
</code></pre>

<p>You can also display the current entries (the stack traces) with:</p>

<pre><code class="language-go">var b bytes.Buffer
gocv.MatProfile.WriteTo(&amp;b, 1)
fmt.Print(b.String())
</code></pre>

<p>If you are using GoCV from an http server, then you can use the <code>net/http/pprof</code> package, and see the <code>MatProfile</code> information from your web browser. The &ldquo;mjpeg-server&rdquo; sample application has been modified to support this. Just run it using <code>-tag matprofile</code> like this to include the custom profiler:</p>

<pre><code>go run -tags matprofile ./cmd/mjpeg-streamer/main.go 0 0.0.0.0:8080
</code></pre>

<p>Once it is running, just navigate to <a href="http://localhost:8080/debug/pprof/">http://localhost:8080/debug/pprof/</a> and click on the &ldquo;gocv.io/x/gocv.Mat&rdquo; link under &ldquo;Types of profiles available&rdquo;. Very cool, thanks again to <a href="https://github.com/dougnd">@dougnd</a>.</p>

<h3 id="stay-informed">Stay Informed</h3>

<p>Want to stay up to date with all our project activity? Follow us on Twitter at <a href="https://twitter.com/GoCVio">@GoCVio</a> for the latest updates.</p>


<footer class=" footline" >
	
</footer>


        
        </div> 
      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


        
            <a class="nav nav-prev" href="/blog/" title="Blog"> <i class="fa fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="/blog/2018-07-05-going-deeper-into-dnn/" title="Going Deeper Into DNN For Computer Vision" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
        
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1543428573"></script>
    <script src="/js/perfect-scrollbar.min.js?1543428573"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1543428573"></script>
    <script src="/js/jquery.sticky-kit.min.js?1543428573"></script>
    <script src="/js/featherlight.min.js?1543428573"></script>
    <script src="/js/html5shiv-printshiv.min.js?1543428573"></script>
    <script src="/js/highlight.pack.js?1543428573"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js?1543428573"></script>
    <script src="/js/learn.js?1543428573"></script>
    <script src="/js/hugo-learn.js?1543428573"></script>

    <link href="/mermaid/mermaid.css?1543428573" type="text/css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1543428573"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

